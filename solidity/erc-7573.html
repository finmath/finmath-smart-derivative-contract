<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0-M16 from src/site/markdown/solidity/erc-7573.md at 2025-03-05
 | Rendered using Apache Maven Fluido Skin 1.11.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0-M16" />
    <meta name="author" content="Christian Fries (@cfries), Peter Kohl-Landgraf (@pekola)" />
    <title>finmath-smart-derivative-contract â€“ Conditional-upon-Transfer-Decryption for DvP</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.11.1.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.11.1.min.js"></script>
<meta name="eip" content="7573" /><meta name="description" content="A Proposal for a Lean and Functional Delivery versus Payment" /><meta name="discussions-to" content="https://ethereum-magicians.org/t/erc-7573-conditional-upon-transfer-decryption-for-delivery-versus-payment/17232" /><meta name="status" content="Draft" /><meta name="type" content="Standards Track" /><meta name="category" content="ERC" /><meta name="created" content="2023-12-05" />  </head>
  <body class="topBarEnabled">
    <header id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
            <ul class="nav">
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">finmath smart derivative contract <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../index.html" title="Introduction">Introduction</a></li>
            <li><a href="../valuationservice.html" title="Valuation Service">Valuation Service</a></li>
            <li><a href="../dockerbuild.html" title="Docker Build">Docker Build</a></li>
            <li class="dropdown-submenu">
<a href="../articles/index.html" title="Articles">Articles</a>
              <ul class="dropdown-menu">
                  <li><a href="../articles/rethinking_part_1.html" title="Rethinking Finacial Derivatives (1)">Rethinking Finacial Derivatives (1)</a></li>
                  <li><a href="../articles/rethinking_part_2.html" title="Rethinking Finacial Derivatives (2)">Rethinking Finacial Derivatives (2)</a></li>
                  <li><a href="../articles/sketch_digital_landscape.html" title="Sketch of a Decentralised Post-Trade Infrastructure">Sketch of a Decentralised Post-Trade Infrastructure</a></li>
              </ul>
            </li>
            <li><a href="../coding/codingconventions.html" title="Coding Conventions">Coding Conventions</a></li>
            <li><a href="../apidocs" title="API Documentation">API Documentation</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="../project-info.html" title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                  <li><a href="../index.html" title="About">About</a></li>
                  <li><a href="../summary.html" title="Summary">Summary</a></li>
                  <li><a href="../scm.html" title="Source Code Management">Source Code Management</a></li>
                  <li><a href="../distribution-management.html" title="Distribution Management">Distribution Management</a></li>
                  <li><a href="../dependency-info.html" title="Dependency Information">Dependency Information</a></li>
                  <li><a href="../dependencies.html" title="Dependencies">Dependencies</a></li>
                  <li><a href="../issue-management.html" title="Issue Management">Issue Management</a></li>
                  <li><a href="../licenses.html" title="Licenses">Licenses</a></li>
                  <li><a href="../team.html" title="Team">Team</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../project-reports.html" title="Project Reports">Project Reports</a>
              <ul class="dropdown-menu">
                  <li><a href="../apidocs/index.html" title="Javadoc">Javadoc</a></li>
              </ul>
            </li>
        </ul>
      </li>
            </ul>
            <ul class="nav pull-right">
              <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown">External Links <b class="caret"></b></a>
                <ul class="dropdown-menu">
    <li><a href="https://www.smartderivativecontract.com/" title="smartderivativecontract">smartderivativecontract</a></li>
                </ul>
              </li>
            </ul>
        </div>
      </div>
    </header>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="http://www.finmath.net/finmath-smart-derivative-contract" id="bannerLeft"><h1>smart derivative contract</h1>
</a></div>
          <div class="pull-right"><a href="http://www.finmath.net" id="bannerRight"><h1>finmath.net</h1>
</a></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2025-03-05<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.2.2</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">finmath smart derivative contract</li>
    <li><a href="../index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="../valuationservice.html" title="Valuation Service"><span class="none"></span>Valuation Service</a></li>
    <li><a href="../dockerbuild.html" title="Docker Build"><span class="none"></span>Docker Build</a></li>
    <li><a href="../articles/index.html" title="Articles"><span class="icon-chevron-right"></span>Articles</a></li>
    <li><a href="../coding/codingconventions.html" title="Coding Conventions"><span class="none"></span>Coding Conventions</a></li>
    <li><a href="../apidocs" title="API Documentation"><span class="none"></span>API Documentation</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
<form id="search-form" action="https://www.google.com/search" method="get" >
  <input value="www.finmath.net/finmath-smart-derivative-contract" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" placeholder="Search with Google..." />
</form>
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<section><section>
<h2>Abstract</h2>
<p>The interfaces in this proposal model a functional transaction scheme to establish a secure <em>delivery-versus-payment</em>
across two blockchains, where a) no intermediary is required and b) one of the two chains
can securely interact with a stateless &#x201c;decryption oracle&#x201d;. Here, <em>delivery-versus-payment</em> refers to the exchange of,
e.g., an asset against a payment; however, the concept is generic to make a transfer of one token on one
chain (e.g., the payment) conditional to the successful transfer of another token on another chain (e.g., the asset).</p>
<p>The scheme is realized by two smart contracts, one on each chain.
One smart contract implements the <code>ILockingContract</code> interface on one chain (e.g. the &#x201c;asset chain&#x201d;), and another smart
contract implements the <code>IDecryptionContract</code> interface on the other chain (e.g., the &#x201c;payment chain&#x201d;).
The smart contract implementing <code>ILockingContract</code> locks a token (e.g., the asset) on its chain until a key is presented
to encrypt to one of two given values.
The smart contract implementing <code>IDecryptionContract</code>, decrypts one of two keys (via the decryption oracle) conditional
to the success or failure of the token transfer (e.g., the payment). A stateless decryption oracle is attached to the
chain running <code>IDecryptionContract</code> for the decryption.</p></section><section>
<h2>Motivation</h2>
<p>Within the domain of financial transactions and distributed ledger technology (DLT), the Hash-Linked Contract (HLC)
concept has been recognized as valuable and has been thoroughly investigated.
The concept may help to solve the challenge of delivery-versus-payment (DvP), especially in cases where the asset chain
and payment system (which may be a chain, too) are separated.
A prominent application of smart contracts realizing a secure DvP is that of buying an asset, where the asset is managed
on one chain (the asset chain), but the payments are executed on another chain (the payment chain).
Proposed solutions are based on an API-based interaction mechanism which bridges the communication between a so-called
asset chain and a corresponding
payment system or requires complex and problematic time-locks.[^1]</p>
<p>Here, we propose a protocol that facilitates secure delivery-versus-payment with less overhead, especially with a
stateless oracle.[^2]</p></section><section>
<h2>Specification</h2><section>
<h3>Methods</h3><section>
<h4>Smart Contract on the chain that performs the locking (e.g. the asset chain)</h4>
<p>The following methods specify the functionality of the smart contract implementing
the locking. For further information, please also look at the interface documentation <code>ILockingContract.sol</code>.</p><section>
<h5>Initiation of Transfer: <code>inceptTransfer</code></h5>

<div class="verbatim">
<pre><code class="language-solidity">function inceptTransfer(bytes32 id, int amount, address from, string memory keyEncryptedSeller) external;
</code></pre></div>
<p>Called from the buyer of the token to initiate token transfer. Emits a <code>TransferIncepted</code> event.
The parameter <code>id</code> is an identifier of the trade. The parameter <code>from</code> is the address of the seller (the address of the
buyer is <code>msg.sender</code>).
The parameter <code>keyEncryptedSeller</code> is an encryption of the key that can be used by the seller to (re-)claim the token.
See below on &#x201c;encryption&#x201d;.</p></section><section>
<h5>Initiation of Transfer: <code>confirmTransfer</code></h5>

<div class="verbatim">
<pre><code class="language-solidity">function confirmTransfer(bytes32 id, int amount, address to, string memory keyEncryptedBuyer) external;
</code></pre></div>
<p>Called from the seller of the token to confirm token transfer. Emits a <code>TransferConfirmed</code> event.
The parameter <code>id</code> is an identifier of the trade. The parameter <code>to</code> is the address of the buyer (the address of the
seller is <code>msg.sender</code>).
The parameter <code>keyEncryptedBuyer</code> is an encryption of the key that can be used by the buyer to claim the token.</p>
<p>If the trade specification, that is, the quadruppel (<code>id</code>, <code>amount</code>, <code>from</code>, <code>to</code>), in a call to <code>confirmTransfer</code>
matches that of a previous call to <code>inceptTransfer</code>, and the balance is sufficient, the corresponding <code>amount</code>
of tokens is locked (transferred from <code>from</code> to the smart contract) and <code>TransferConfirmed</code> is emitted.</p></section><section>
<h5>Transfer: <code>transferWithKey</code></h5>

<div class="verbatim">
<pre><code class="language-solidity">function transferWithKey(bytes32 id, string memory key) external;
</code></pre></div>
<p>Called from either the buyer or the seller of the token
of the trade with id <code>id</code>.</p>
<p>If the method is called from the buyer (<code>to</code>) <em>and</em> the encryption of <code>key</code> matches <code>keyEncryptedBuyer</code>,
then the locked tokens are transferred to the buyer (<code>to</code>). This emits <code>TokenClaimed</code>.</p>
<p>If the method is called from the seller (<code>from</code>) <em>and</em> the encryption of <code>key</code> matches <code>keyEncryptedSeller</code>,
then the locked tokens are transferred (back) to the seller (<code>to</code>). This emits <code>TokenReclaimed</code>.</p></section><section>
<h5>Summary</h5>
<p>The interface <code>ILockingContract</code>:</p>

<div class="verbatim">
<pre><code class="language-solidity">interface ILockingContract {
    event TransferIncepted(bytes32 id, int amount, address from, address to, string keyEncryptedSeller);
    event TransferConfirmed(bytes32 id, int amount, address from, address to, string keyEncryptedBuyer);
    event TokenClaimed(bytes32 id, string key);
    event TokenReclaimed(bytes32 id, string key);

    function inceptTransfer(bytes32 id, int amount, address from, string memory keyEncryptedSeller) external;

    function confirmTransfer(bytes32 id, int amount, address to, string memory keyEncryptedBuyer) external;

    function transferWithKey(bytes32 id, string memory key) external;
}
</code></pre></div></section></section><section>
<h4>Smart Contract on the other chain that performs the conditional decryption (e.g. the payment chain)</h4>
<p>The following methods specify the functionality of the smart contract implementing
the conditional decryption. For further information, please also look at the interface
documentation <code>IDecryptionContract.sol</code>.</p><section>
<h5>Initiation of Transfer: <code>inceptTransfer</code></h5>

<div class="verbatim">
<pre><code class="language-solidity">function inceptTransfer(bytes32 id, int amount, address from, string memory keyEncryptedSuccess, string memory keyEncryptedFailure) external;
</code></pre></div>
<p>Called from the receiver of the amount to initiate payment transfer. Emits a <code>PaymentTransferIncepted</code>.
The parameter <code>id</code> is an identifier of the trade. The parameter <code>from</code> is the address of the sender of the payment (the
address of the receiver is <code>msg.sender</code>).
The parameter <code>keyEncryptedSuccess</code> is an encryption of the key and will be decrypted if the transfer is successful in a
call to <code>transferAndDecrypt</code>.
The parameter <code>keyEncryptedFailure</code> is an encryption of the key and will be decrypted if the transfer fails in a call
to <code>transferAndDecrypt</code> or if <code>cancelAndDecrypt</code>is successful.</p></section><section>
<h5>Transfer: <code>transferAndDecrypt</code></h5>

<div class="verbatim">
<pre><code class="language-solidity">function transferAndDecrypt(bytes32 id, int amount, address to, string memory keyEncryptedSuccess, string memory keyEncryptedFailure) external;
</code></pre></div>
<p>Called from the sender of the amount to initiate completion of the payment transfer. Emits a <code>TransferKeyRequested</code>
and <code>TransferKeyReleased</code> with keys depending on completion success.
The parameter <code>id</code> is an identifier of the trade. The parameter <code>to</code> is the address of the receiver of the payment (the
sender of the payment (from) is implicitly the <code>msg.sender</code>).
The parameter <code>keyEncryptedSuccess</code> is an encryption of the key and will be decrypted if the transfer is successful.
The parameter <code>keyEncryptedFailure</code> is an encryption of the key and will be decrypted if the transfer failed.</p>
<p>The method will not decrypt any key and not perfrom a transfer of a payment if the values (<code>id</code>, <code>amount</code>, <code>from</code> <code>to</code>
, <code>keyEncryptedSuccess</code>, <code>keyEncryptedFailure</code>)
do not match a previous call to <code>inceptTransfer</code>.</p></section><section>
<h5>Cancelation of Transfer: <code>cancelAndDecrypt</code></h5>

<div class="verbatim">
<pre><code class="language-solidity">function cancelAndDecrypt(bytes32 id, address from, string memory keyEncryptedSuccess, string memory keyEncryptedFailure) external;
</code></pre></div>
<p>Called from the receiver of the amount to cancel payment transfer (cancels the incept transfer).</p>
<p>The method must be called from the caller of a previous call to <code>inceptTransfer</code>
with the exact same arguments and cancels this specific transfer.</p></section><section>
<h5>Summary</h5>
<p>The interface <code>IDecryptionContract</code>:</p>

<div class="verbatim">
<pre><code class="language-solidity">interface IDecryptionContract {
    event TransferIncepted(bytes32 id, int amount, address from, address to, string keyEncryptedSuccess, string keyEncryptedFailure);
    event TransferKeyRequested(bytes32 id, string encryptedKey);
    event TransferKeyReleased(bytes32 id, bool success, string key);

    function inceptTransfer(bytes32 id, int amount, address from, string memory keyEncryptedSuccess, string memory keyEncryptedFailure) external;

    function transferAndDecrypt(bytes32 id, int amount, address to, string memory keyEncryptedSuccess, string memory keyEncryptedFailure) external;

    function cancelAndDecrypt(bytes32 id, address from, string memory keyEncryptedSuccess, string memory keyEncryptedFailure) external;
}
</code></pre></div></section></section></section><section>
<h3>Encryption and Decryption</h3>
<p>The linkage of the two smart contract relies on use of a <code>key</code> and <code>encryptedKey</code>.
The implementation is free to support several encryption methods for
as long as the decryption oracle supports it.</p>
<p>The encryption is performed with the public key of
the decryption oracle, which is known to both parties.</p>
<p>It is implicitly assumed that the two parties may check that
the strings <code>keyEncryptedBuyer</code> and <code>keyEncryptedSeller</code> are
in a valid format.</p></section><section>
<h3>Sequence diagram of delivery versus payment</h3>
<p>The interplay of the two smart contracts is summarized
in the following sequence diagram:</p>
<p><img src="../assets/eip-7573/doc/DvP-Seq-Diag.png" alt="image info" /></p></section></section><section>
<h2>Rationale</h2>
<p>The protocol tries to be parsimonious. The transfer
is associated with a (preferable unique) <code>id</code> possibly
generated by some additional interaction of the trading
parties.</p>
<p>The <code>key</code> and the <code>encryptedKey</code> arguments are strings to
allow the flexible use of different encryption schemes.
The decryption/encryption scheme should be inferable from the contents
of the <code>encryptedKey</code>.</p></section><section>
<h2>Security Considerations</h2>
<p>No known security issues up to now.</p></section><section>
<h2>Copyright</h2>
<p>Copyright and related rights waived via <a href="../LICENSE.html">CC0</a>.</p>
<p>[^1]:</p>

<div class="verbatim">
<pre><code class="language-csl-json">
    {
      &quot;type&quot;: &quot;article&quot;,
      &quot;id&quot;: 1,
      &quot;author&quot;: [
        {
          &quot;family&quot;: &quot;La Rocca&quot;,
          &quot;given&quot;: &quot;Rosario&quot;
        },
        {
          &quot;family&quot;: &quot;Mancini&quot;,
          &quot;given&quot;: &quot;Riccardo&quot;
        },
        {
          &quot;family&quot;: &quot;Benedetti&quot;,
          &quot;given&quot;: &quot;Marco&quot;
        },
        {
          &quot;family&quot;: &quot;Caruso&quot;,
          &quot;given&quot;: &quot;Matteo&quot;
        },
        {
          &quot;family&quot;: &quot;Cossu&quot;,
          &quot;given&quot;: &quot;Stefano&quot;
        },
        {
          &quot;family&quot;: &quot;Galano&quot;,
          &quot;given&quot;: &quot;Giuseppe&quot;
        },
        {
          &quot;family&quot;: &quot;Mancini&quot;,
          &quot;given&quot;: &quot;Simone&quot;
        },
        {
          &quot;family&quot;: &quot;Marcelli&quot;,
          &quot;given&quot;: &quot;Gabriele&quot;
        },
        {
          &quot;family&quot;: &quot;Martella&quot;,
          &quot;given&quot;: &quot;Piero&quot;
        },
        {
          &quot;family&quot;: &quot;Nardelli&quot;,
          &quot;given&quot;: &quot;Matteo&quot;
        },
        {
          &quot;family&quot;: &quot;Oliviero&quot;,
          &quot;given&quot;: &quot;Ciro&quot;
        }
      ],
      &quot;DOI&quot;: &quot;10.2139/ssrn.4386904&quot;,
      &quot;title&quot;: &quot;Integrating DLTs with Market Infrastructures: Analysis and Proof-of-Concept for Secure DvP between TIPS and DLT Platforms&quot;,
      &quot;original-date&quot;: {
        &quot;date-parts&quot;: [
          [2022, 7, 19]
        ]
      },
      &quot;URL&quot;: &quot;http://dx.doi.org/10.2139/ssrn.4386904&quot;
    }

</code></pre></div>
<p>[^2]:</p>

<div class="verbatim">
<pre><code class="language-csl-json">    {
      &quot;type&quot;: &quot;article&quot;,
      &quot;id&quot;: 2,
      &quot;author&quot;: [
        {
          &quot;family&quot;: &quot;Fries&quot;,
          &quot;given&quot;: &quot;Christian&quot;
        },
        {
          &quot;family&quot;: &quot;Kohl-Landgraf&quot;,
          &quot;given&quot;: &quot;Peter&quot;
        }
      ],
      &quot;DOI&quot;: &quot;10.2139/ssrn.4628811&quot;,
      &quot;title&quot;: &quot;A Proposal for a Lean and Functional Delivery versus Payment across two Blockchains&quot;,
      &quot;original-date&quot;: {
        &quot;date-parts&quot;: [
          [2023, 11, 9]
        ]
      },
      &quot;URL&quot;: &quot;http://dx.doi.org/10.2139/ssrn.4628811&quot;
    }
</code></pre></div></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2025
</p>
        </div>
      </div>
    </footer>
<script>
	if(anchors) {
	  anchors.add();
	}
</script>
  </body>
</html>